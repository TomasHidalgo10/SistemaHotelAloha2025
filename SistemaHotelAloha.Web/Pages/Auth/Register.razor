@page "/auth/register"
@attribute [Microsoft.AspNetCore.Authorization.AllowAnonymous]
@using SistemaHotelAloha.Web.Auth
@inject SimpleAuthStateProvider Auth
@inject NavigationManager Nav
@inject IJSRuntime JS

<h3>Registrarse</h3>

<div class="card" style="max-width:520px">
    <div class="card-body">
        <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input class="form-control" @bind="_name" />
        </div>
        <div class="mb-3">
            <label class="form-label">Email</label>
            <input class="form-control" @bind="_email" type="email" />
        </div>
        <div class="mb-3">
            <label class="form-label">Password</label>
            <input class="form-control" @bind="_pass" type="password" />
        </div>
        <button class="btn btn-success w-100" @onclick="DoRegister" disabled="@_loading">
            @(_loading ? "Creando..." : "Crear cuenta")
        </button>
        <div class="mt-3">
            <NavLink href="/auth/login">¿Ya tenés cuenta? Iniciar sesión</NavLink>
        </div>
    </div>
</div>

@code {
    private string _name = "";
    private string _email = "";
    private string _pass = "";
    private bool _loading;

    private async Task DoRegister()
    {
        if (string.IsNullOrWhiteSpace(_name) ||
            string.IsNullOrWhiteSpace(_email) ||
            string.IsNullOrWhiteSpace(_pass))
        {
            await JS.InvokeVoidAsync("alert", "Completá todos los campos");
            return;
        }

        try
        {
            _loading = true;

            // En esta demo, nos auto-logueamos al registrarnos
            await Auth.SignInAsync(userId: 1, name: _name, email: _email, role: "User");
            await JS.InvokeVoidAsync("alert", "Cuenta creada. ¡Bienvenido!");
            Nav.NavigateTo("/", forceLoad: false);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"[Register] {ex}");
            await JS.InvokeVoidAsync("alert", "No se pudo registrar.");
        }
        finally
        {
            _loading = false;
        }
    }
}
