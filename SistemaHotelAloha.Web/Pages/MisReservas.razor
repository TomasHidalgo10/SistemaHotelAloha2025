@page "/mis-reservas"

@inject SistemaHotelAloha.Web.Services.BookingService BookingSvc
@inject AuthenticationStateProvider Auth

<h2>Mis reservas</h2>

@if (items is null) { <p>Cargando...</p> }
else if (items.Count == 0) { <p>No tenés reservas.</p> }
else
{
    @foreach (var r in items)
    {
        <div class="card">
            <p><b>Reserva #@r.Id</b> — Hotel: @r.HotelId — Hab.: @r.HabitacionTipoId</p>
            <p>@r.CheckIn → @r.CheckOut · Total @r.Total.ToString("C")</p>
        </div>
    }
}

@code {
    List<SistemaHotelAloha.Web.Models.Reserva>? items;

    protected override async Task OnInitializedAsync()
    {
        var state = await Auth.GetAuthenticationStateAsync();
        var user = state.User.Identity?.IsAuthenticated == true
                    ? state.User.Identity!.Name!
                    : "invitado";

        items = await BookingSvc.MiasAsync(user); 
    }
}
}
